{
    "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
    "width": 600,
    "height": 400,
    "title": "Average Departure Delay from ATL",
    "layer": [
      {
        "data": {
          "url": "us.json",
          "format": {
            "type": "topojson",
            "feature": "us.geo"
          }
        },
        "projection": {
          "type": "albersUsa"
        },
        "mark": {
          "type": "geoshape",
          "fill": "lightgray",
          "stroke": "white"
        }
      },
      {
        "data": {
          "url": "data/airports.csv"
        },
        "projection": {
          "type": "albersUsa"
        },
        "mark": "circle",
        "encoding": {
          "longitude": {
            "field": "LONGITUDE",
            "type": "quantitative"
          },
          "latitude": {
            "field": "LATITUDE",
            "type": "quantitative"
          },
          "size": {"value": 5},
          "color": {"value": "gray"}
        }
      },
      {
        "data": {
          "url": "data/flights_new.csv"
        },
        "transform": [
          {"filter": {"field": "ORIGIN_AIRPORT", "equal": "ATL"}},
          {
            "lookup": "ORIGIN_AIRPORT",
            "from": {
              "data": {
                "url": "data/airports.csv"
              },
              "key": "IATA_CODE",
              "fields": ["LATITUDE", "LONGITUDE"]
            },
            "as": ["ORIGIN_LATITUDE", "ORIGIN_LONGITUDE"]
          },
          {
            "lookup": "DESTINATION_AIRPORT",
            "from": {
              "data": {
                "url": "data/airports.csv"
              },
              "key": "IATA_CODE",
              "fields": ["LATITUDE", "LONGITUDE"]
            },
            "as": ["DESTINATION_LATITUDE", "DESTINATION_LONGITUDE"]
          }
        ],
        "projection": {
          "type": "albersUsa"
        },
        "mark": "rule",
        "encoding": {
          "longitude": {
            "field": "ORIGIN_LONGITUDE",
            "type": "quantitative"
          },
          "latitude": {
            "field": "ORIGIN_LATITUDE",
            "type": "quantitative"
          },
          "latitude2": {"field": "DESTINATION_LATITUDE"},
          "longitude2": {"field": "DESTINATION_LONGITUDE"},
          "color": {"field": "DEPARTURE_DELAY", "type": "quantitative", 
        "aggregate": "average", "scale": {"domainMid": 50, "range": "diverging"}},
          "size": {"field": "DEPARTURE_DELAY", "type": "quantitative", 
          "aggregate": "average"}
              }
      }
    ]
  }
