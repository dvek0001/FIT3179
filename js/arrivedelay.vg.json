{
    "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
    "width": 800,
    "height": 600,
    "title": "Average Arrival Delay to ATL",
    "layer": [
      {
        "data": {
          "url": "https://raw.githubusercontent.com/dvek0001/FIT3179/main/js/us.json",
          "format": {
            "type": "topojson",
            "feature": "gz_2010_us_040_00_500k"
          }
        },
        "projection": {
          "type": "albersUsa"
        },
        "mark": {
          "type": "geoshape",
          "fill": "lightgray",
          "stroke": "white"
        }
      },
      {
        "data": {
          "url": "https://raw.githubusercontent.com/dvek0001/FIT3179/main/data/airports.csv"
        },
        "projection": {
          "type": "albersUsa"
        },
        "mark": {"type":"circle", "size": 15},
        "encoding": {
          "longitude": {
            "field": "LONGITUDE",
            "type": "quantitative"
          },
          "latitude": {
            "field": "LATITUDE",
            "type": "quantitative"
          },
          "color": {"value": "gray"},
          "tooltip": [
            {"field": "IATA_CODE", "type": "nominal"},
            {"field": "AIRPORT", "type": "nominal"},
            {"field": "CITY", "type": "nominal"},
            {"field": "STATE", "type": "nominal"}
          ]
        }
      },
      {
        "data": {
          "url": "https://raw.githubusercontent.com/dvek0001/FIT3179/main/data/flights.csv"
        },
        "transform": [
          {"filter": {"field": "DESTINATION_AIRPORT", "equal": "ATL"}},
          {
            "lookup": "ORIGIN_AIRPORT",
            "from": {
              "data": {
                "url": "https://raw.githubusercontent.com/dvek0001/FIT3179/main/data/airports.csv"
              },
              "key": "IATA_CODE",
              "fields": ["LATITUDE", "LONGITUDE"]
            },
            "as": ["ORIGIN_LATITUDE", "ORIGIN_LONGITUDE"]
          },
          {
            "lookup": "DESTINATION_AIRPORT",
            "from": {
              "data": {
                "url": "https://raw.githubusercontent.com/dvek0001/FIT3179/main/data/airports.csv"
              },
              "key": "IATA_CODE",
              "fields": ["LATITUDE", "LONGITUDE"]
            },
            "as": ["DESTINATION_LATITUDE", "DESTINATION_LONGITUDE"]
          }
        ],
        "projection": {
          "type": "albersUsa"
        },
        "mark": {"type": "rule", "size": 2.5},
        "encoding": {
          "longitude": {
            "field": "ORIGIN_LONGITUDE",
            "type": "quantitative"
          },
          "latitude": {
            "field": "ORIGIN_LATITUDE",
            "type": "quantitative"
          },
          "latitude2": {"field": "DESTINATION_LATITUDE"},
          "longitude2": {"field": "DESTINATION_LONGITUDE"},
          "color": {
            "field": "ARRIVAL_DELAY", 
            "type": "quantitative", 
            "aggregate": "average",
            "scale": {
                "scheme": "redblue",
                "domainMid": 0,
                "reverse": true
            }
          }
        }
      }
    ]
  }